# Charles Capture

Локальный сервер-сборщик ответов API из Charles Proxy (HAR).  
Следит за `.har`-файлами, вытаскивает JSON-ответы и сохраняет их в `data/<runName>__<ENV>`, затем формирует отчёт.

---

## Требования
- **Node.js ? 18**
    - Скачать: [https://nodejs.org/](https://nodejs.org/)
    - Проверить установку:
      ```bash
      node -v
      ```
      Должно вывести что-то вроде `v18.20.2` или выше.
- **Charles Proxy**
    - Включено **Tools → Auto Save → HTTP Archive (HAR)** (для автоматического сохранения HAR-файлов в папку `harDir`).
    - Настроено подключение (трафик приложения или устройства идёт через Charles Proxy).
    - Включён фильтр в **View → Recording Settings → Include** — добавьте хосты или паттерны запросов, которые нужно сохранять.  
      Например: `*api*` или конкретные домены из окружения (`uat.api.company.com` и т.п.).  
      ? Порты указывать не обязательно — так меньше «шума» в логах.

---

## Установка

### 1. Подготовка
1. Склонируйте проект или скачайте архив.
2. Создайте `config.json` и скопируйте в него содержимое из → `config.example.json`, затем укажите свои значения:
    - **`charles.harDir`** — путь к папке, куда Charles сохраняет HAR-файлы
        - Windows: `C:/Users/<username>/CharlesHAR`
        - macOS/Linux: `/Users/<username>/CharlesHAR`
    - **`charles.hostGroups`** — хосты для окружений `stg`, `uat`, `prod`.
    - **`runtime.env`** — текущее окружение по умолчанию (`stg` / `uat` / `prod`).

Файл `config.json` **не попадает в git** (он в `.gitignore`). Все реальные хосты и пути остаются только у вас.

---

## Запуск

### Windows (через батник)
1. В корне проекта есть файл [`run-manager.bat`](./run-manager.bat).
2. Запустить можно двумя способами:
    - Дважды кликнуть по файлу в Проводнике.
    - Или из терминала, предварительно перейти в папку проекта:

      #### PowerShell (Windows 10/11 по умолчанию):
      ```powershell
      cd "ПОЛНЫЙ_ПУТЬ_К_ПРОЕКТУ"
      .\run-manager.bat
      ```

      #### cmd.exe:
      ```cmd
      cd /d "ПОЛНЫЙ_ПУТЬ_К_ПРОЕКТУ"
      run-manager.bat
      ```
---

## CLI-меню
После запуска появится интерактивное меню:

```text
===============================
  Менеджер сбора API из Charles
===============================
Окружение: UAT (хосты: …)
-------------------------------
Основное меню:
  1. Начать сбор из Charles
  2. Остановить сбор из Charles
  3. Сформировать и открыть отчёт
  4. Выход

Дополнительно:
  5. Выбрать окружение (STG/UAT/PROD)
  6. Проверка HAR-папки
  7. Очистить данные текущего сбора
  8. Просканировать все сохранённые HAR
  9. Очистить папку HAR
 10. Показать настройки и проверить конфиг


